<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<measures xmlns="http://www.quartetfs.com"
	xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.quartetfs.com ../activepivot-types.xsd">

	<!--Measures-->
    <measure name="OPEN.SUM" field="Open" visible="false" formatter="DOUBLE[#,###.00;-#,###.00]" />
    <measure name="Open.AVG" field="Open" visible="false" aggregation="AVG" formatter="DOUBLE[#,###.00;-#,###.00]" />
    <measure name="CLOSE.SUM" field="Close" visible="false" formatter="DOUBLE[#,###.00;-#,###.00]" />
    <measure name="Close.AVG" field="Close" visible="false" aggregation="AVG" formatter="DOUBLE[#,###.00;-#,###.00]" />
    <measure field="Volume" folder="data" formatter="DOUBLE[#,###.00;-#,###.00]" />
    <measure name="NumberStocks" field="NumberStocks" folder="data" formatter="DOUBLE[#,###.00;-#,###.00]" />

	<!--The prices should not be added when corresponding to different products-->
    <!--However, one accepts to average price of different products-->
    <postProcessor name="Open.SUM" pluginKey="MINIMUM_DEPTH" underlyingMeasures="OPEN.SUM" folder="data" >
        <properties>
            <entry key="hierarchyName" value="StockSymbol" />
            <entry key="minimumDepth" value="1" />
        </properties>
    </postProcessor>

    <postProcessor name="Close.SUM" pluginKey="MINIMUM_DEPTH" underlyingMeasures="CLOSE.SUM" folder="data" >
        <properties>
            <entry key="hierarchyName" value="StockSymbol" />
            <entry key="minimumDepth" value="1" />
        </properties>
    </postProcessor>

    <!--One accepts to aggregate the stock number-->

    <!--Computing the portfolio value-->
    <postProcessor name="PortfolioValue" pluginKey="PORTFOLIO_VALUE" folder="postProc" underlyingMeasures="NumberStocks,Close.AVG" >
        <properties>
            <entry key="leafLevels" value="StockSymbol@StockSymbol@StockSymbol" />
            <entry key="aggregatedFunctions" value="SUM" />
            <entry key="outputType" value="double" />
        </properties>
    </postProcessor>

    <!--Computing the weight of the portfolio components-->
    <postProcessor name="TotalPortfolioValue" pluginKey="TOTAL_PORTFOLIO_VALUE" folder="hidden" underlyingMeasures="PortfolioValue">
        <properties>
            <entry key="levelToShift" value="Name@CompaniesRegroupment@CompaniesRegroupment" />
        </properties>
    </postProcessor>

    <postProcessor name="PortfolioValueWeights" pluginKey="FORMULA" folder="postProc">
        <properties>
            <entry key="formula" value="aggregatedValue[PortfolioValue],aggregatedValue[TotalPortfolioValue],int[0],div" />
        </properties>
    </postProcessor>

    <!--Computing the period return-->
    <postProcessor name="PeriodReturn" folder="postProc" pluginKey="FORMULA">
        <properties>
            <entry key="formula" value="((aggregatedValue[PortfolioValue],aggregatedValue[PreviousPortfolioValue],-),aggregatedValue[PreviousPortfolioValue],int[0],div),int[100],*" />
        </properties>
    </postProcessor>

    <postProcessor name="PreviousPortfolioValue" pluginKey="NeighborValue" folder="hidden">
        <properties>
            <entry key="timeHierarchyName" value="HistoricalDates" />
            <entry key="streamMeasureName" value="PortfolioValue" />
            <entry key="direction" value="previous" />
            <entry key="memberToRemove" value="0" />
            <entry key="reverseDimensionOrder" value="false" />
        </properties>
    </postProcessor>



    <!--Computing the cumulative return-->
    <postProcessor name="CumulativeReturn" pluginKey="FORMULA" folder="postProc">
        <properties>
            <entry key="formula" value="((aggregatedValue[PortfolioValue], aggregatedValue[InitialValue], -),aggregatedValue[InitialValue],/),int[100],*"/>
        </properties>
    </postProcessor>

    <postProcessor name="InitialValue" pluginKey="INITIAL_VALUE" folder="hidden">
        <properties>
            <entry key="timeHierarchyName" value="HistoricalDates" />
            <entry key="streamMeasureName" value="PortfolioValue" />
            <entry key="reverseDimensionOrder" value="false" />
            <entry key="memberToRemove" value="0" />
        </properties>
    </postProcessor>

    <!-- Failed :( -->
    <postProcessor name="TimeShiftedPortfolioValue" pluginKey="TIME_SHIFTED_PORTFOLIO_VALUE" folder="failed" underlyingMeasures="PortfolioValue">
        <properties>
            <entry key="levelToShift" value="Date@HistoricalDates@Time" />
        </properties>
    </postProcessor>

    <postProcessor name="PeriodPerformances" isIntrospectionMeasure="false" folder="failed" pluginKey="Stream2Position">
        <properties>
            <entry key="timeHierarchyName" value="HistoricalDates" />
            <entry key="streamMeasureName" value="PortfolioValue" />
            <entry key="positionType" value="CURRENT_STREAM" />
            <entry key="reverseDimensionOrder" value="false" />
        </properties>
    </postProcessor>

</measures>