<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<measures xmlns="http://www.quartetfs.com"
	xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.quartetfs.com ../activepivot-types.xsd">

	<!--Measures-->
    <measure name="OPEN.SUM" field="Open" visible="false" formatter="DOUBLE[#,###.00;-#,###.00]" />
    <measure name="Open.AVG" field="Open" visible="false" aggregation="AVG" formatter="DOUBLE[#,###.00;-#,###.00]" />
    <measure name="CLOSE.SUM" field="Close" visible="false" formatter="DOUBLE[#,###.00;-#,###.00]" />
    <measure name="Close.AVG" field="Close" visible="false" aggregation="AVG" formatter="DOUBLE[#,###.00;-#,###.00]" />
    <measure field="Volume" folder="data" formatter="DOUBLE[#,###.00;-#,###.00]" />
    <measure name="NumberStocks" field="NumberStocks" folder="data" formatter="DOUBLE[#,###.00;-#,###.00]" />

	<!--Data formating : the prices should not be added when corresponding to different products-->
    <!--However, one accepts to average price of different products-->
    <postProcessor name="Open.SUM" pluginKey="MINIMUM_DEPTH" underlyingMeasures="OPEN.SUM" folder="data" >
        <properties>
            <entry key="hierarchyName" value="StockSymbol" />
            <entry key="minimumDepth" value="1" />
        </properties>
    </postProcessor>

    <postProcessor name="Close.SUM" pluginKey="MINIMUM_DEPTH" underlyingMeasures="CLOSE.SUM" folder="data" >
        <properties>
            <entry key="hierarchyName" value="StockSymbol" />
            <entry key="minimumDepth" value="1" />
        </properties>
    </postProcessor>

    <!--One accepts to aggregate the stock number-->

    <!--Computing the portfolio value-->

    <postProcessor name="PortfolioValue" pluginKey="PORTFOLIO_VALUE" folder="postProc" underlyingMeasures="NumberStocks,Close.AVG" >
        <properties>
            <entry key="leafLevels" value="StockSymbol@StockSymbol@StockSymbol" />
            <entry key="aggregatedFunctions" value="SUM" />
            <entry key="outputType" value="double" />
        </properties>
    </postProcessor>

    <!--Computing the weight of the portfolio components-->
    <postProcessor name="TotalPortfolioValue" pluginKey="TOTAL_PORTFOLIO_VALUE" underlyingMeasures="PortfolioValue">
        <properties>
            <entry key="levelToShift" value="Type" />
        </properties>
    </postProcessor>

    <postProcessor name="Weights" pluginKey="FORMULA" folder="postProc">
        <properties>
            <entry key="formula" value="aggregatedValue[PortfolioValue],aggregatedValue[TotalPortfolioValue],/" />
        </properties>
    </postProcessor>

    <!--Computing the period performances-->
    <postProcessor name="ShiftedPortfolioValue" pluginKey="SHIFTED_PORTFOLIO_VALUE" folder="Hidden" underlyingMeasures="PortfolioValue">
        <properties>
            <entry key="levelToShift" value="Date@HistoricalDates@Time" />
        </properties>
    </postProcessor>

    <postProcessor name="ValuesVariation" folder="Hidden" pluginKey="FORMULA">
        <properties>
            <entry key="formula" value="aggregatedValue[PortfolioValue],aggregatedValue[ShiftedPortfolioValue],-,aggregatedValue[ShiftedPortfolioValue],/" />
        </properties>
    </postProcessor>

    <postProcessor name="PeriodPerformances" folder="postProc" pluginKey="Stream2Position">
        <properties>
            <entry key="timeHierarchyName" value="HistoricalDates" />
            <entry key="streamMeasureName" value="ValuesVariation" />
            <entry key="positionType" value="CURRENT_STREAM" />
            <entry key="reverseDimensionOrder" value="false" />
        </properties>
    </postProcessor>

</measures>